{% extends 'base.html' %}
{% load static %}


{% block content %}
    <div id="select-oferta" class="container text-center mt-5">
        <select  class="form-select w-50 mx-auto" aria-label="Default select example">
            <option selected>Seleccione una oferta</option>
            {% for offer in  school_offers%}
                <option value="{{offer.anexo}} | {{offer.oferta}}"> Anexo {{offer.anexo}} | {{offer.oferta}}</option>
            {% endfor %}
        </select>
        <div class="container">
            <canvas id="Puntaje" class="mt-5">
                
            </canvas>
            <canvas id="Desempenio" class="mt-5">
                
            </canvas>
        </div>
        
    </div>


    <script>


        const selectElement = $('#select-oferta');

        selectElement.on('change', (event) => {
        $.ajax({
                url: `/school/performance-chart/${event.target.value}`,
                type: 'GET',
                success: function (data) {
                    console.log(data)
                            var ctx = $("#Desempenio");
                            var Desempenio = new Chart(ctx, {
                                type: "bar",
                                data: data,
                                stacked:true,
                                options: {
                                    scales: {
                                        yAxes: [{
                                            ticks: {
                                                beginAtZero: true,
                                                callback: function(value, index, values) {
                                                    return value * 100 + '%';
                                                }
                                            }
                                        }]
                                    },
                                    tooltips: {
                                        callbacks: {
                                            label: function(tooltipItem, data) {
                                                var label = data.datasets[tooltipItem.datasetIndex].label || '';
                                                if (label) {
                                                    label += ': ';
                                                }
                                                label += (parseFloat(tooltipItem.yLabel)*100).toFixed(2) + '%';
                                                return label;
                                            }
                                        }
                                    },
                                    title: {
                                    display: true,
                                    text: 'Desempe√±o',
                                    fontSize: 48
                                    },
                                }
                            });
                        }
            });
            
            $.ajax({
                url: `/school/total-score-chart/${event.target.value}`,
                type: 'GET',
                success: function (data) {
                    console.log(data)
                            var ctx = $("#Puntaje");
                            var Desempenio = new Chart(ctx, {
                                type: "bar",
                                data: data,
                                stacked:false,
                                options: {
                                    scales: {
                                        yAxes: [{
                                            ticks: {
                                                beginAtZero: true,
                                            }
                                        }]
                                    },
                                    title: {
                                    display: true,
                                    text: 'Puntaje Total',
                                    fontSize: 48
                                    },
                                }
                            });
                        }
            });


        });


    </script>

{% endblock content %}



    <script>

    </script>